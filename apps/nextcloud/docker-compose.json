{
  "services": {
    "db-nextcloud": {
      "image": "postgres:17",
      "container_name": "db-nextcloud",
      "restart": "unless-stopped",
      "volumes": [
        "${APP_DATA_DIR}/data/postgres:/var/lib/postgresql/data"
      ],
      "environment": {
        "POSTGRES_DB": "nextcloud",
        "POSTGRES_USER": "tipi",
        "POSTGRES_PASSWORD": "tipi"
      },
      "healthcheck": {
        "test": ["CMD-SHELL", "pg_isready -U tipi"],
        "interval": "10s",
        "timeout": "5s",
        "retries": 5
      }
    },
    "redis-nextcloud": {
      "image": "redis:alpine",
      "container_name": "redis-nextcloud",
      "restart": "unless-stopped"
    },
    "nextcloud": {
      "image": "nextcloud:apache",
      "container_name": "nextcloud",
      "restart": "unless-stopped",
      "ports": [
        "8050:80"
      ],
      "volumes": [
        "${APP_DATA_DIR}/data/nextcloud:/var/www/html"
      ],
      "environment": {
        "POSTGRES_DB": "nextcloud",
        "POSTGRES_USER": "tipi",
        "POSTGRES_PASSWORD": "tipi",
        "POSTGRES_HOST": "db-nextcloud",
        "REDIS_HOST": "redis-nextcloud"
      },
      "dependsOn": {
        "db-nextcloud": {
          "condition": "service_healthy"
        },
        "redis-nextcloud": {
          "condition": "service_started"
        }
      }
    }
  }
}
